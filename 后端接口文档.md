


          
# 后端接口规范文档

## 基础信息
- **服务器地址**: `http://localhost:3000`
- **静态文件路径**: `/uploads/` (图片文件)
- **API前缀**: `/api`

---

## 1. 认证接口 (Auth)

### 1.1 用户注册
- **URL**: `POST /api/auth/register`
- **描述**: 用户注册接口
- **请求体**:
```json
{
  "username": "string",
  "password": "string",
  "email": "string"
}
```
- **响应**:
```json
{
  "message": "注册成功",
  "user": {
    "_id": "string",
    "username": "string",
    "email": "string",
    "points": 0
  }
}
```

### 1.2 用户登录
- **URL**: `POST /api/auth/login`
- **描述**: 用户登录接口
- **请求体**:
```json
{
  "username": "string",
  "password": "string"
}
```
- **响应**:
```json
{
  "message": "登录成功",
  "user": {
    "_id": "string",
    "username": "string",
    "email": "string",
    "points": 0
  }
}
```

---

## 2. 商品接口 (Shop)

### 2.1 获取所有商品
- **URL**: `GET /api/shop/goods`
- **描述**: 获取商城所有商品列表
- **响应**:
```json
{
  "message": "获取商品数据成功",
  "data": [
    {
      "_id": "string",
      "goods_name": "string",
      "goods_image": "string",
      "points_required": 100,
      "stock": 50,
      "description": "string"
    }
  ],
  "total": 10
}
```

---

## 3. 购买接口 (Purchase)

### 3.1 获取用户积分
- **URL**: `GET /api/purchase/points`
- **描述**: 获取当前用户积分（需要认证）
- **请求头**: `Authorization: Bearer {token}`
- **响应**:
```json
{
  "success": true,
  "points": 1500
}
```

### 3.2 购买商品
- **URL**: `POST /api/purchase/purchase`
- **描述**: 购买商品（需要认证）
- **请求头**: `Authorization: Bearer {token}`
- **请求体**:
```json
{
  "goods_id": "string",
  "quantity": 1,
  "total_points": 100
}
```
- **响应**:
```json
{
  "success": true,
  "message": "购买成功",
  "purchaseRecord": {
    "user_id": "string",
    "goods_id": "string",
    "goods_name": "string",
    "quantity": 1,
    "total_points": 100,
    "purchase_time": "2024-01-01T00:00:00.000Z"
  },
  "remainingPoints": 1400
}
```

---

## 4. 上传和回收接口 (Upload/Recycle)

### 4.1 图片上传
- **URL**: `POST /api/upload`
- **描述**: 上传垃圾图片
- **请求类型**: `multipart/form-data`
- **参数**:
  - `image`: 图片文件
  - `user_id`: 用户ID
  - `category`: 垃圾类别 (plastic/paper/metal/glass)
- **响应**:
```json
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "imageUrl": "/uploads/1769248278119-884162921.jpg",
    "filename": "1769248278119-884162921.jpg"
  }
}
```

### 4.2 提交回收记录
- **URL**: `POST /api/recycle`
- **描述**: 提交垃圾回收记录
- **请求体**:
```json
{
  "user_id": "string",
  "image_url": "string",
  "category": "plastic",
  "points": 10
}
```
- **响应**:
```json
{
  "success": true,
  "message": "回收记录提交成功，等待审核",
  "data": {
    "audit_id": "string",
    "created_at": "2024-01-01T00:00:00.000Z"
  }
}
```

### 4.3 获取用户回收记录
- **URL**: `GET /api/recycle/user/:user_id`
- **描述**: 获取指定用户的回收记录
- **参数**: `user_id` (路径参数)
- **响应**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "string",
      "garbage_img": "/uploads/1769248278119-884162921.jpg",
      "garbage_category": "plastic",
      "audit_status": "等待中",
      "points_earned": 10,
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

---

## 5. 数据模型说明

### 用户模型 (User)
```javascript
{
  _id: ObjectId,
  username: String,
  password: String,
  email: String,
  points: Number,
  createdAt: Date
}
```

### 商品模型 (Shop)
```javascript
{
  _id: ObjectId,
  goods_name: String,
  goods_image: String,
  points_required: Number,
  stock: Number,
  description: String
}
```

### 审核记录模型 (Audit)
```javascript
{
  _id: ObjectId,
  user_id: ObjectId,
  garbage_img: String,
  garbage_category: String,
  audit_status: String,
  points_earned: Number,
  createdAt: Date
}
```

---

## 6. Vue前端使用示例

```javascript
// API基础配置
const API_BASE = 'http://localhost:3000/api';

// 认证接口示例
async function login(username, password) {
  const response = await fetch(`${API_BASE}/auth/login`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ username, password })
  });
  return await response.json();
}

// 上传图片示例
async function uploadImage(file, userId, category) {
  const formData = new FormData();
  formData.append('image', file);
  formData.append('user_id', userId);
  formData.append('category', category);
  
  const response = await fetch(`${API_BASE}/upload`, {
    method: 'POST',
    body: formData
  });
  return await response.json();
}

// 获取回收记录示例
async function getUserRecords(userId) {
  const response = await fetch(`${API_BASE}/recycle/user/${userId}`);
  return await response.json();
}
```

---

## 7. 注意事项

- **图片路径处理**: 后端返回相对路径，前端需要拼接完整URL
- **认证机制**: 购买相关接口需要JWT认证
- **文件上传**: 使用multipart/form-data格式，限制5MB
- **错误处理**: 所有接口都包含success字段标识操作状态


# 4.4 获取所有审核记录（新增）
URL: GET /api/recycle
描述: 获取所有审核记录（管理员或用于统计）
查询参数:
page: 页码，默认为1
limit: 每页数量，默认为10
status: 审核状态筛选（可选）
响应:

json
Apply
{
  "success": true,
  "data": [
    {
      "_id": "string",
      "user_id": {
        "_id": "string",
        "username": "string",
        "email": "string",
        "points": 100
      },
      "garbage_img": "/uploads/1769248278119-884162921.jpg",
      "garbage_category": "plastic",
      "audit_status": "等待中",
      "points_earned": 10,
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "pagination": {
    "currentPage": 1,
    "totalPages": 5,
    "totalRecords": 50,
    "hasNext": true,
    "hasPrev": false
  }
}

# 4.5 更新审核状态（新增）
URL: PUT /api/recycle/:audit_id/status
描述: 管理员更新审核记录的状态（通过/拒绝）
路径参数:
audit_id: 审核记录ID
请求体:

json
Apply
{
  "audit_status": "string",     // 审核状态："审核通过" 或 "审核失败"
  "points_earned": 10          // 可选：如果审核通过，获得的积分数
}
响应:

json
Apply
{
  "success": true,
  "message": "审核状态更新成功",
  "data": {
    "_id": "string",
    "user_id": {
      "_id": "string",
      "username": "string",
      "email": "string",
      "points": 110  // 如果审核通过，积分会增加
    },
    "garbage_img": "/uploads/1769248278119-884162921.jpg",
    "garbage_category": "plastic",
    "audit_status": "审核通过",
    "points_earned": 10,
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  }
}
错误响应:

json
Apply
{
  "success": false,
  "message": "审核记录不存在"
}
使用示例：

javascript
Apply
// 更新审核状态示例
async function updateAuditStatus(auditId, status, points = 0) {
  const response = await fetch(`${API_BASE}/recycle/${auditId}/status`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      audit_status: status,      // '审核通过' 或 '审核失败'
      points_earned: points      // 如果是通过，可以获得的积分
    })
  });
  return await response.json();
}
现在您的系统有了完整的审核管理功能，管理员可以通过这个接口来更新审核状态，并且在审核通过时自动为用户增加相应积分。