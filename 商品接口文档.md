


          
# 商品管理接口规范文档

## 基础信息
- **服务器地址**: http://localhost:3000
- **API前缀**: /api/shop
- **数据模型**: Shop (goods_id, goods_name, goods_info, goods_price, createdAt, updatedAt)

## 数据模型说明

### 商品模型 (Shop)
```javascript
{
  "_id": ObjectId,           // MongoDB自动生成的唯一标识符
  "goods_id": String,        // 商品ID (必填，唯一)
  "goods_name": String,      // 商品名称 (必填)
  "goods_info": String,      // 商品描述 (必填)
  "goods_price": Number,     // 商品价格/所需积分 (必填)
  "createdAt": Date,         // 创建时间 (自动添加)
  "updatedAt": Date          // 更新时间 (自动添加)
}
```

## 管理员商品管理接口

### 1. 添加商品
- **URL**: POST /api/shop/add
- **描述**: 管理员添加新商品
- **请求头**: 
  ```javascript
  {
    "Content-Type": "application/json"
  }
  ```
- **请求体**:
  ```javascript
  {
    "goods_id": "goods001",                           // 商品ID (必填，唯一)
    "goods_name": "垃圾袋",                          // 商品名称 (必填)
    "goods_info": "加厚防漏环保垃圾袋，一次性家用厨房办公专用",  // 商品描述 (必填)
    "goods_price": 20                                // 商品价格/所需积分 (必填)
  }
  ```
- **成功响应**:
  ```javascript
  {
    "success": true,
    "message": "商品添加成功",
    "data": {
      "_id": "60f1...",
      "goods_id": "goods001",
      "goods_name": "垃圾袋",
      "goods_info": "加厚防漏环保垃圾袋，一次性家用厨房办公专用",
      "goods_price": 20,
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    }
  }
  ```
- **错误响应**:
  ```javascript
  {
    "success": false,
    "message": "商品ID已存在" // 或其他错误信息如 "缺少必需字段"、"数据验证失败" 等
  }
  ```

### 2. 更新商品信息
- **URL**: PUT /api/shop/:goods_id
- **描述**: 管理员更新商品信息（包括价格/积分）
- **路径参数**:
  - `goods_id`: 要更新的商品ID
- **请求头**:
  ```javascript
  {
    "Content-Type": "application/json"
  }
  ```
- **请求体** (所有字段可选):
  ```javascript
  {
    "goods_name": "加厚垃圾袋",                        // 新商品名称 (可选)
    "goods_info": "全新升级版加厚防漏环保垃圾袋",           // 新商品描述 (可选)
    "goods_price": 25                                 // 新价格/所需积分 (可选)
  }
  ```
- **成功响应**:
  ```javascript
  {
    "success": true,
    "message": "商品信息更新成功",
    "data": {
      "_id": "60f1...",
      "goods_id": "goods001",
      "goods_name": "加厚垃圾袋",
      "goods_info": "全新升级版加厚防漏环保垃圾袋",
      "goods_price": 25,
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T11:00:00.000Z"
    }
  }
  ```
- **错误响应**:
  ```javascript
  {
    "success": false,
    "message": "商品不存在" // 或其他错误信息
  }
  ```

### 3. 删除商品
- **URL**: DELETE /api/shop/:goods_id
- **描述**: 管理员删除指定商品
- **路径参数**:
  - `goods_id`: 要删除的商品ID
- **成功响应**:
  ```javascript
  {
    "success": true,
    "message": "商品删除成功",
    "data": {
      "_id": "60f1...",
      "goods_id": "goods001",
      "goods_name": "垃圾袋",
      "goods_info": "加厚防漏环保垃圾袋，一次性家用厨房办公专用",
      "goods_price": 20,
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    }
  }
  ```
- **错误响应**:
  ```javascript
  {
    "success": false,
    "message": "商品不存在" // 或其他错误信息
  }
  ```

### 4. 获取单个商品信息
- **URL**: GET /api/shop/:goods_id
- **描述**: 获取指定商品的详细信息
- **路径参数**:
  - `goods_id`: 要获取的商品ID
- **成功响应**:
  ```javascript
  {
    "success": true,
    "data": {
      "_id": "60f1...",
      "goods_id": "goods001",
      "goods_name": "垃圾袋",
      "goods_info": "加厚防漏环保垃圾袋，一次性家用厨房办公专用",
      "goods_price": 20,
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z"
    }
  }
  ```
- **错误响应**:
  ```javascript
  {
    "success": false,
    "message": "商品不存在"
  }
  ```

### 5. 获取所有商品信息
- **URL**: GET /api/shop/goods
- **描述**: 获取所有商品信息
- **成功响应**:
  ```javascript
  {
    "message": "获取商品数据成功",
    "data": [
      {
        "_id": "60f1...",
        "goods_id": "goods001",
        "goods_name": "垃圾袋",
        "goods_info": "加厚防漏环保垃圾袋，一次性家用厨房办公专用",
        "goods_price": 20,
        "createdAt": "2024-01-01T10:00:00.000Z",
        "updatedAt": "2024-01-01T10:00:00.000Z"
      },
      // ... 其他商品
    ],
    "total": 商品总数
  }
  ```
- **错误响应**:
  ```javascript
  {
    "message": "获取商品数据失败",
    "error": 错误信息
  }
  ```

## Vue前端使用示例

### 添加商品
```javascript
async function addProduct(productData) {
  try {
    const response = await fetch('http://localhost:3000/api/shop/add', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(productData)
    });
    
    const result = await response.json();
    if (result.success) {
      console.log('商品添加成功:', result.data);
      return result.data;
    } else {
      console.error('商品添加失败:', result.message);
      return null;
    }
  } catch (error) {
    console.error('网络错误:', error);
    return null;
  }
}

// 使用示例
const newProduct = {
  goods_id: "goods002",
  goods_name: "分类垃圾桶",
  goods_info: "四分类家用环保垃圾桶，垃圾分类必备",
  goods_price: 50
};

addProduct(newProduct);
```

### 更新商品
```javascript
async function updateProduct(goodsId, updateData) {
  try {
    const response = await fetch(`http://localhost:3000/api/shop/${goodsId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(updateData)
    });
    
    const result = await response.json();
    if (result.success) {
      console.log('商品更新成功:', result.data);
      return result.data;
    } else {
      console.error('商品更新失败:', result.message);
      return null;
    }
  } catch (error) {
    console.error('网络错误:', error);
    return null;
  }
}

// 使用示例 - 更新商品积分
updateProduct("goods001", { goods_price: 25 });
```

### 删除商品
```javascript
async function deleteProduct(goodsId) {
  try {
    const response = await fetch(`http://localhost:3000/api/shop/${goodsId}`, {
      method: 'DELETE'
    });
    
    const result = await response.json();
    if (result.success) {
      console.log('商品删除成功');
      return true;
    } else {
      console.error('商品删除失败:', result.message);
      return false;
    }
  } catch (error) {
    console.error('网络错误:', error);
    return false;
  }
}

// 使用示例
deleteProduct("goods001");
```

### 获取单个商品
```javascript
async function getProduct(goodsId) {
  try {
    const response = await fetch(`http://localhost:3000/api/shop/${goodsId}`);
    const result = await response.json();
    
    if (result.success) {
      console.log('获取商品成功:', result.data);
      return result.data;
    } else {
      console.error('获取商品失败:', result.message);
      return null;
    }
  } catch (error) {
    console.error('网络错误:', error);
    return null;
  }
}

// 使用示例
getProduct("goods001");
```

### 获取所有商品
```javascript
async function getAllProducts() {
  try {
    const response = await fetch('http://localhost:3000/api/shop/goods');
    const result = await response.json();
    
    if (result.message === '获取商品数据成功') {
      console.log('获取所有商品成功:', result.data);
      return result.data;
    } else {
      console.error('获取商品失败:', result.message);
      return [];
    }
  } catch (error) {
    console.error('网络错误:', error);
    return [];
  }
}

// 使用示例
getAllProducts();
```

## 注意事项

1. **权限控制**: 这些管理接口应仅限管理员访问，实际部署时需要添加身份验证中间件
2. **数据验证**: 所有接口都进行适当的数据验证
3. **错误处理**: 前端需要妥善处理各种错误情况
4. **唯一性约束**: goods_id 字段在数据库中设置了唯一约束，重复添加会失败
5. **数据类型**: goods_price 必须为数字类型，用于控制商品兑换所需的积分数量
6. **API前缀**: 所有商品相关接口都使用 `/api/shop` 前缀

---

**文档版本**: 1.0  
**最后更新**: 2024-01-01
        